<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Orçamento #{{ venda.id }} - Eletromaster</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            @page { margin: 0; size: A4; }
            body { margin: 1.6cm; -webkit-print-color-adjust: exact; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-white text-gray-800 text-sm font-sans" onload="window.print()">

    <div class="flex justify-between items-start border-b-2 border-gray-800 pb-6 mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 uppercase tracking-wide">Eletromaster</h1>
            <p class="text-gray-500 text-xs uppercase tracking-widest font-bold mt-1">Pintura Eletrostática & Serviços</p>
        </div>
        <div class="text-right">
            <h2 class="text-xl font-bold text-gray-600">ORÇAMENTO</h2>
            <p class="text-lg font-bold text-red-600">#{{ venda.id }}</p>
            <p class="text-gray-500 text-xs mt-1">Data: {{ venda.criado_em.strftime('%d/%m/%Y') }}</p>
        </div>
    </div>

    <div class="flex justify-between mb-8">
        <div class="w-1/2 pr-4">
            <h3 class="text-xs font-bold text-gray-400 uppercase mb-2 border-b">Dados do Cliente</h3>
            <p class="font-bold text-lg">{{ venda.cliente_nome }}</p>
            {% if venda.cliente_documento %}<p>CPF/CNPJ: {{ venda.cliente_documento }}</p>{% endif %}
            <p>{{ venda.cliente_contato }}</p>
            {% if venda.cliente_email %}<p>{{ venda.cliente_email }}</p>{% endif %}
        </div>
        <div class="w-1/2 pl-4 text-right">
            <h3 class="text-xs font-bold text-gray-400 uppercase mb-2 border-b">Emissor</h3>
            <p class="font-bold">{{ venda.vendedor.nome }}</p>
            <p>Eletromaster Ltda.</p>
            <p>contato@eletromaster.com.br</p>
        </div>
    </div>

    <div class="mb-8">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-100 text-gray-600 uppercase text-xs">
                    <th class="p-3 border-b-2 border-gray-300">Descrição / Serviço</th>
                    <th class="p-3 border-b-2 border-gray-300 text-center">Qtd</th>
                    <th class="p-3 border-b-2 border-gray-300 text-right">Unitário</th>
                    <th class="p-3 border-b-2 border-gray-300 text-right">Total</th>
                </tr>
            </thead>
            <tbody>
                {% if venda.modo == 'multipla' %}
                    {% for item in venda.itens %}
                    <tr class="border-b border-gray-200">
                        <td class="p-3">
                            <span class="font-bold block">{{ item.descricao }}</span>
                            <span class="text-xs text-gray-500">{{ item.produto.nome if item.produto else 'Serviço Diverso' }}</span>
                        </td>
                        <td class="p-3 text-center">{{ item.quantidade }}</td>
                        <td class="p-3 text-right">R$ {{ "%.2f"|format(item.valor_unitario)|replace('.', ',') }}</td>
                        <td class="p-3 text-right font-bold">R$ {{ "%.2f"|format(item.valor_total)|replace('.', ',') }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr class="border-b border-gray-200">
                        <td class="p-3">
                            <span class="font-bold block">{{ venda.descricao_servico }}</span>
                            <span class="text-xs text-gray-500">
                                {{ venda.produto.nome if venda.produto else (venda.cor.nome if venda.cor else '-') }}
                                ({{ venda.dimensao_1 }} x {{ venda.dimensao_2 }})
                            </span>
                        </td>
                        <td class="p-3 text-center">{{ venda.quantidade_pecas }}</td>
                        <td class="p-3 text-right">R$ {{ "%.2f"|format(venda.valor_final / venda.quantidade_pecas)|replace('.', ',') }}</td>
                        <td class="p-3 text-right font-bold">R$ {{ "%.2f"|format(venda.valor_final)|replace('.', ',') }}</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <div class="flex justify-end mb-12">
        <div class="w-1/3 space-y-2">
            <div class="flex justify-between text-gray-600">
                <span>Subtotal:</span>
                <span>R$ {{ "%.2f"|format(venda.valor_base)|replace('.', ',') }}</span>
            </div>
            {% if venda.valor_acrescimo > 0 %}
            <div class="flex justify-between text-blue-600">
                <span>Acréscimo:</span>
                <span>+ R$ {{ "%.2f"|format(venda.valor_acrescimo)|replace('.', ',') }}</span>
            </div>
            {% endif %}
            {% if venda.valor_desconto_aplicado > 0 %}
            <div class="flex justify-between text-red-600">
                <span>Desconto:</span>
                <span>- R$ {{ "%.2f"|format(venda.valor_desconto_aplicado)|replace('.', ',') }}</span>
            </div>
            {% endif %}
            <div class="flex justify-between text-xl font-black text-gray-900 border-t-2 border-gray-900 pt-2">
                <span>TOTAL:</span>
                <span>R$ {{ "%.2f"|format(venda.valor_final)|replace('.', ',') }}</span>
            </div>
        </div>
    </div>

    {% if venda.observacoes_internas %}
    <div class="bg-gray-50 p-4 rounded border border-gray-200 mb-8 text-xs">
        <h4 class="font-bold text-gray-500 uppercase mb-1">Observações</h4>
        <p>{{ venda.observacoes_internas }}</p>
    </div>
    {% endif %}

    <div class="text-center text-xs text-gray-400 mt-12 pt-6 border-t">
        <p>Este documento é um orçamento e não garante reserva de estoque sem confirmação.</p>
        <p>Gerado pelo ERP Eletromaster em {{ venda.criado_em.strftime('%d/%m/%Y às %H:%M') }}</p>
    </div>

    <div class="no-print fixed bottom-6 right-6 flex gap-2">
        <button onclick="window.print()" class="bg-blue-600 text-white px-6 py-3 rounded-full shadow-lg font-bold hover:bg-blue-700 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
            Imprimir / Salvar PDF
        </button>
        <button onclick="window.close()" class="bg-gray-600 text-white px-4 py-3 rounded-full shadow-lg font-bold hover:bg-gray-700">
            Fechar
        </button>
    </div>

</body>
</html>